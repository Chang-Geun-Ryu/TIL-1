### ARC(Automatic Reference Counting)

RC 자동 관리 방식 (WWDC 2011 발표)
컴파일러가 개발자를 대신하여 메모리 관리 코드를 적절한 위치에 자동으로 삽입



스위프트에서 메모리를 관리하는 역할은 `ARC(Automatic Reference Counting)`가  담당합니다. 이것은 객체를 가리키는 레퍼런스의 숫자를 관리하는 의미를 가지고 있으며, 실제로도 숫자를 관리합니다.



GC(Garbage Collection) 처럼 런타임이 아닌 컴파일 단에서 처리 (Heap에 대한 스캔 불필요/ 앱 일시 정지 현상 없음)메모리 관리 이슈를 줄이고 개발자가 코딩 자체에 집중할 수 있도록 함



ARC 는 클래스의 인스턴스에만 적용 (Class - Reference 타입 , Struct / Enum - Value 타입) 활성화된 참조카운트가 하나라도 있을 경우 메모리에서 해제 되지 않음 참조 타입

 -강한 참조 (Strong) : 기본값 참조될 때마다 참조 카운트 1 증가 

 -약한 참조 (Weak), 미소유 참조 (Unowned) : 참조 카운트를 증가시키지 않음 

강한 순환 참조 (Strong Reference Cycles)에 대한 주의 필요



레퍼런스 숫자는 클래스로부터 만들어진 인스턴스 객체에만 적용도는 개념입니다. 따라서 Int, String과 같은 기본 자료형이나 구조체(struct), 열거형(enum) 과 같은 값타입 에는 적용되지 않습니다.





## How ARC Works

매번 새로운 Class 인스턴스를 생성할때마다, ARC는 해당 인스턴스의 정보를 적재하기 위해 메모리의 chunk(덩어리)를 할당합니다. 이 메모리는 인스터느 타입에 대한 정보를 해당 인스턴스와 관련되어 저장된 프로퍼티들의 값을 함께 포함하여 유지합니다.



클래스 인스턴스에 프로퍼티, 상수, 변수를 할당할 때 마다 이러한 프로퍼티, 상수, 변수 들은 인스턴스에 Strong 참조를 생성합니다. 이때의 참조를 강한참조(Strong reference)라고 하는데, 강한참조는 인스턴스를 강하게 잡고 유지하며, 최소한 한개 이상의 강한참조가 남아 있는 한, 그동안에는 인스턴스가 래제되는 것을 허용하지 않기 때문입니다.





### 강한 참조(Strong reference cycle)의 문제

Weak, Unowned 참조는 참조순환 내에 있는 인스턴스를 다른 인스턴스에 대해 강한참조로 잡고 있지 않도록 할 수 있습니다.

그렇게 되면 인스턴스들은 서로를 참조할 때 강한 참조순환 문제가 발생하지 않으면서 참조할 수 있게 됩니다.



- ##### Weak(약한 참조)

강한참조를 유지하지 않습니다. 또한 ARC가 참조된 인스턴스를 해제하느 것을 막지 않습니다. 이 행위는 강한참조 순환을 방지해 줍니다. 즉 인스턴스가 해제 될때, 액한참조에 대해 자동으로 nil로 설정을 해줍니다.



- ##### Unowned(미소유 참조)

약한 참조(weak reference) 와 같이, 미소유 참조(unowned reference) 또한 참조하는 인스턴스를 강하게 참조하지 않습니다 (weak reference와 동일하게 ARC 카운트를 증가시키지 않습니다.)

다만 약한 참조와의 차이점은 참조하여는 다른 인스턴스가 본인과 생애주기가 같거나 더 길 경우에 사용 됩니다.

미소유 참조(unowned reference) 는 항상 값이 있는것으로 간주합니다.

그 결과, ARC는 미소유 참조의 값을 nil로 설정하지 않습니다. 이는 미소유 참조의 값이 옵셔널값이 아닌것 (non-optional)으로 정의됨을 의미 합니다.



> 중요! 아직 메모리에서 해재되니 않은 인스턴스를 참조하는 것을 확신 할 때 만 미소유 참조를 사용하야 합니다. 만약 미소유 참조 값이 메모리 상에 없는 상태에서 접근 할 경우 런타임 에러를 야기 할 수 있습니다.















https://0urtrees.tistory.com/66